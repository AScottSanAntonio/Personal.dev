<!doctype html>
<html>
<head>
	<title>The Mobile Library of Herdan DnD Map</title>
	<script src="https://ondras.github.io/rot.js/rot.js"></script>
	<script src="/js/rot.min.js"></script>
</head>
<body>
	<h1>The Mobile Library of Herdan</h1>
</body>
<script>
var Game = {
    display: null,
    map: {},
    engine: null,
    player: null,

   
    
    init: function() {
        this.display = new ROT.Display();
        document.body.appendChild(this.display.getContainer());
        
        this._generateMap();
        
        var scheduler = new ROT.Scheduler.Simple();
        scheduler.add(this.player, true);

        this.engine = new ROT.Engine(scheduler);
        this.engine.start();
    },
    
    _generateMap: function() {
        var digger = new ROT.Map.Digger();
        var freeCells = [];
        
        var digCallback = function(x, y, value) {
            if (value) { return; }
            
            var key = x+","+y;
            this.map[key] = ".";
            freeCells.push(key);
        }
        digger.create(digCallback.bind(this));
        
        
        this._drawWholeMap();
        this._createPlayer(freeCells);
    },
    
    _createPlayer: function(freeCells) {
        var index = Math.floor(ROT.RNG.getUniform() * freeCells.length);
        var key = freeCells.splice(index, 1)[0];
        var parts = key.split(",");
        var x = parseInt(parts[0]);
        var y = parseInt(parts[1]);
        this.player = new Player(x, y);
    },
  
    
    _drawWholeMap: function() {
    	
    	this.map = {

    		//Room1  

    		//Top Wall

    		"62,15": "=", 
    		"63,15": "=",
    		"64,15": "=",
    		"65,15": "=",
    		"66,15": "=",
    		"67,15": "=",
    		"68,15": "=",
    		"69,15": "=",
    		"70,15": "=",
    		"71,15": "=",
    		"72,15": "=",
    		"73,15": "=",
    		"74,15": "=",
    		"75,15": "=",
    		"76,15": "=",
    		"77,15": "=",


    		//Bottom Wall

    		"49,24": "=",
    		"50,24": "=",
    		"51,24": "=",
    		"52,24": "=",
    		"53,24": "=",
    		"54,24": "=",
    		"55,24": "=",
    		"56,24": "=",
    		"57,24": "=",
    		"58,24": "=",
    		"59,24": "=",
    		"60,24": "=",
    		"61,24": "=",
    		"62,24": "=",
    		"63,24": "=",
    		"64,24": "=",
    		"65,24": "=",
    		"66,24": "=",
    		"67,24": "=",
    		"68,24": "=",
    		"69,24": "=",
    		"70,24": "=",
    		"71,24": "=",
    		"72,24": "=",
    		"73,24": "=",
    		"74,24": "=",
    		"75,24": "=",
    		"76,24": "|",
    		
    		

    		//Right Wall
    		"77,16": ".",
    		"78,15": "=",
			"78,16": "|",
    		"78,17": "|",
    		"78,18": "|",
    		"78,19": "|",
    		"78,20": "|",
    		"78,21": "/",
    		"77,22": "/",
    		"76,22": "_",
    		"76,23": "|",

    		"62,16": "[]",
    		"63,16": " ",
    		"64,16": "[]",
    		"65,16": " ",
    		"66,16": "[]",
    		"67,16": ".",
    		"68,16": ".",
    		"69,16": ".",
    		"70,16": ".",
    		"71,16": ".",
    		"72,16": ".",
    		"73,16": ".",
    		"74,16": ".",
    		"75,16": ".",
    		"76,16": ".",
    		"62,17": "[]",
    		"63,17": " ",
    		"64,17": "[]",
    		"65,17": " ",
    		"66,17": "[]",
    		"67,17": ".",
    		"68,17": ".",
    		"69,17": ".",
    		"70,17": ".",
    		"71,17": ".",
    		"72,17": ".",
    		"73,17": ".",
    		"74,17": ".",
    		"75,17": ".",
    		"44,17": ".",

    		//2nd layer//
    		
    		"62,18": "[]",
    		"63,18": " ",
    		"64,18": "[]",
    		"65,18": " ",
    		"66,18": "[]",
    		"67,18": ".",
    		"68,18": ".",
    		"69,18": ".",
    		"70,18": ".",
    		"71,18": ".",
    		"72,18": ".",
    		"73,18": ".",
    		"74,18": ".",
    		"75,18": ".",
    		"44,18": ".",
    		"62,19": "|",
    		"63,19": " ",
    		"64,19": "|",
    		"65,19": " ",
    		"66,19": "|",
    		"67,19": ".",
    		"68,19": ".",
    		"69,19": ".",
    		"70,19": ".",
    		"71,19": ".",
    		"72,19": ".",
    		"73,19": ".",
    		"74,19": ".",
    		"75,19": ".",
    		"44,19": ".",

    		"76,21": ".",
    		"76,20": ".",
    		"76,19": ".",
    		"76,18": ".",
    		"76,17": ".",
    		"77,21": ".",
    		"77,20": ".",
    		"77,19": ".",
    		"77,18": ".",
    		"77,17": ".",

    		//3rd layer room filler

    		"62,20": "|",
    		"63,20": " ",
    		"64,20": "|",
    		"65,20": " ",
    		"66,20": "|",
    		"67,20": ".",
    		"68,20": ".",
    		"69,20": ".",
    		"70,20": ".",
    		"71,20": ".",
    		"72,20": ".",
    		"73,20": ".",
    		"74,20": ".",
    		"75,20": ".",
    		"44,20": ".",
    		"62,21": "|",
    		"63,21": " ",
    		"64,21": "|",
    		"65,21": " ",
    		"66,21": "|",
    		"67,21": ".",
    		"68,21": ".",
    		"69,21": ".",
    		"70,21": ".",
    		"71,21": ".",
    		"72,21": ".",
    		"73,21": ".",
    		"74,21": ".",
    		"75,21": ".",
    		"62,22": "|",
    		"63,22": " ",
    		"64,22": "|",
    		"65,22": " ",
    		"66,22": "|",
    		"67,22": ".",
    		"68,22": ".",
    		"69,22": ".",
    		"70,22": ".",
    		"71,22": ".",
    		"72,22": ".",
    		"73,22": ".",
    		"74,22": ".",
    		"75,22": ".",
    		"62,23": "|",
    		"63,23": " ",
    		"64,23": "|",
    		"65,23": " ",
    		"66,23": "|",
    		"67,23": ".",
    		"68,23": ".",
    		"69,23": ".",
    		"70,23": ".",
    		"71,23": ".",
    		"72,23": ".",
    		"73,23": ".",
    		"74,23": ".",
    		"75,23": ".",

    		//4th layer room2 filler

    		"61,23": ".",
    		"60,23": ".",
    		"59,23": ".",
    		"58,23": ".",
    		"57,23": ".",
    		"56,23": ".",
    		"55,23": ".",
    		"54,23": ".",
    		"53,23": ".",
    		"52,23": ".",
    		"51,23": ".",
    		"50,23": ".",
    		"49,23": ".",

    		"61,22": ".",
    		"60,22": ".",
    		"59,22": ".",
    		"58,22": ".",
    		"57,22": ".",
    		"56,22": ".",
    		"55,22": ".",
    		"54,22": ".",
    		"53,22": ".",
    		"52,22": ".",
    		"51,22": ".",
    		"50,22": ".",
    		"49,22": ".",

    		"61,21": ".",
    		"60,21": ".",
    		"59,21": ".",
    		"58,21": ".",
    		"57,21": ".",
    		"56,21": ".",
    		"55,21": ".",
    		"54,21": ".",
    		"53,21": ".",
    		"52,21": ".",
    		"51,21": ".",
    		"50,21": ".",
    		"49,21": ".",

    		"61,20": ".",
    		"60,20": ".",
    		"59,20": ".",
    		"58,20": ".",
    		"57,20": ".",
    		"56,20": ".",
    		"55,20": ".",
    		"54,20": ".",
    		"53,20": ".",
    		"52,20": ".",
    		"51,20": ".",
    		"50,20": ".",
    		"49,20": ".",
    		



    	};
        for (var key in this.map) {
            var parts = key.split(",");
            var x = parseInt(parts[0]);
            var y = parseInt(parts[1]);
            this.display.draw(x, y, this.map[key]);
        }
    }
};

var Player = function(x, y) {
    this._x = x;
    this._y = y;
    this._draw();
}
    
Player.prototype.act = function() {
    Game.engine.lock();
    window.addEventListener("keydown", this);
}
    
Player.prototype.handleEvent = function(e) {
    var keyMap = {};
    keyMap[87] = 0;
    keyMap[33] = 1;
    keyMap[68] = 2;
    keyMap[34] = 3;
    keyMap[83] = 4;
    keyMap[35] = 5;
    keyMap[65] = 6;
    keyMap[36] = 7;

    var code = e.keyCode;
    /* one of numpad directions? */
    if (!(code in keyMap)) { return; }

    /* is there a free space? */
    var dir = ROT.DIRS[8][keyMap[code]];
    var newX = this._x + dir[0];
    var newY = this._y + dir[1];
    var newKey = newX + "," + newY;
    if (!(newKey in Game.map)) { return; }

    Game.display.draw(this._x, this._y, Game.map[this._x+","+this._y]);
    this._x = newX;
    this._y = newY;
    this._draw();
    window.removeEventListener("keydown", this);
    Game.engine.unlock();
}

Player.prototype._draw = function() {
    Game.display.draw(this._x, this._y, "Î©", "#ff0");
}    

Game.init();

</script>
</html>
